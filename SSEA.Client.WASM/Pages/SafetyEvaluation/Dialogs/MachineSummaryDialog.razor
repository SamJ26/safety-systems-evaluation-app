
<MudDialog Style="width: 1000px;">
    <TitleContent>
        <MudGrid>
            <MudItem Style="width: 5%;" />
            <MudItem Style="width: 90%;">
                <MudText Align="Align.Center" Typo="Typo.h5">Machine summary</MudText>
            </MudItem>
            <MudItem Style="width: 5%;">
                <MudIconButton @onclick="@Cancel" Icon="@Icons.Material.Filled.Clear" Color="Color.Error" Disabled="@disabled"></MudIconButton>
            </MudItem>
        </MudGrid>
    </TitleContent>
    <DialogContent>
        <MudExpansionPanels>
            @if (data is not null && data.AccessPoints is not null)
            {
                @foreach (var accessPoint in data.AccessPoints)
                {
                    <MudExpansionPanel>
                        <TitleContent>
                            <MudGrid>
                                <MudItem Style="width: 5%;">
                                    <MudIconButton @onclick="@(() => GoToAccessPointDetail(accessPoint.AccessPointId))" Icon="@Icons.Material.Filled.Search" Color="Color.Info" Disabled="@disabled" Style="padding: 0px;"/>
                                </MudItem>
                                <MudItem Style="width: 55%;">
                                    <MudText>
                                        <strong>@accessPoint.AccessPointName</strong>
                                    </MudText>
                                </MudItem>
                                <MudItem Style="width: 40%;">
                                    <MudText Color="Color.Success">
                                        @accessPoint.AccessPointState.Name
                                    </MudText>
                                </MudItem>
                            </MudGrid>
                        </TitleContent>
                        <ChildContent>
                            <MudList Clickable="true">
                                @foreach (var safetyFunction in accessPoint.SafetyFunctions)
                                {
                                    <MudListItem OnClick="@(() => GoToSafetyFunctionDetail(safetyFunction.SafetyFunctionId, accessPoint.AccessPointId))">
                                        <MudGrid>
                                            <MudItem Style="width: 65%;">
                                                @safetyFunction.SafetyFunctionName
                                            </MudItem>
                                            <MudItem Style="width: 35%;">
                                                @safetyFunction.SafetyFunctionState.Name
                                            </MudItem>
                                        </MudGrid>
                                    </MudListItem>
                                    <MudDivider />
                                }
                            </MudList>
                        </ChildContent>
                    </MudExpansionPanel>
                }
            }
        </MudExpansionPanels>
    </DialogContent>
</MudDialog>

@code {

    [Inject]
    private MachineFacade machineFacade { get; set; }

    [Inject]
    private NavigationManager navigationManager { get; set; }

    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; }

    private MachineSafetySummaryModel data = new();

    [Parameter]
    public int MachineId { get; set; }

    [Parameter]
    public string EvaluationMethod { get; set; }

    private bool disabled = false;

    protected override async Task OnInitializedAsync()
    {
        data = await machineFacade.GetMachineSafetySummaryAsync(MachineId);
    }

    private void Cancel() => MudDialog.Cancel();

    private void GoToAccessPointDetail(int accessPointId)
    {
        navigationManager.NavigateTo($"/safetyEvaluation/accessPointDetail/{MachineId}/{accessPointId}");
    }

    private void GoToSafetyFunctionDetail(int safetyFunctionId, int accessPointId)
    {
        navigationManager.NavigateTo($"/safetyEvaluation/safetyFunctionDetail/{EvaluationMethod}/{MachineId}/{accessPointId}/{safetyFunctionId}");
    }

}