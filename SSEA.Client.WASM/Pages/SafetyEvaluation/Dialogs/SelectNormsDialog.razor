
<MudDialog>
    <TitleContent>
        <MudText Align="Align.Center" Typo="Typo.h5">Select norms</MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12">
                <MudTable Items="@Norms" MultiSelection="true" @bind-SelectedItems="selectedItems" Height="300px" Hover="true">
                    <HeaderContent>
                        <MudTh>Name</MudTh>
                        <MudTh>Label</MudTh>
                        <MudTh>Category</MudTh>
                        <MudTh>Up to date</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Name">@context.Name</MudTd>
                        <MudTd DataLabel="Label">@context.Label</MudTd>
                        <MudTd DataLabel="Category">@context.NormCategory</MudTd>
                        <MudTd DataLabel="Up to date">@context.IsValid</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudItem>
            <MudItem xs="6">
                <MudButton Variant="Variant.Filled" OnClick="Cancel" Style="width:100%; margin-bottom: 10px;">Cancel</MudButton>
            </MudItem>
            <MudItem xs="6">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Submit" Style="width:100%; margin-bottom: 10px;">Save</MudButton>
            </MudItem>
        </MudGrid>
    </DialogContent>
</MudDialog>

@code {

    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public int MachineId { get; set; }

    [Parameter]
    public ICollection<NormModel> Norms { get; set; } = new List<NormModel>();

    [Parameter]
    public ICollection<MachineNormModel> SelectedNorms { get; set; } = new List<MachineNormModel>();

    private HashSet<NormModel> selectedItems = new HashSet<NormModel>();

    protected override void OnInitialized()
    {
        Console.WriteLine($"Norms count: {Norms.Count}");
        Console.WriteLine($"Machine id: {MachineId}");
    }

    void Submit()
    {
        foreach (var norm in selectedItems)
        {
            MachineNormModel model = new()
            {
                MachineId = MachineId,
                NormId = norm.Id,
                Norm = norm,
            };
            SelectedNorms.Add(model);
        }
        MudDialog.Close(DialogResult.Ok(true));
    }

    void Cancel() => MudDialog.Cancel();
}
